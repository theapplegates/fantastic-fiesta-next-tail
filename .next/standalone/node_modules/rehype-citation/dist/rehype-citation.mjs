import{visit as e}from"unist-util-visit";import t from"parse5";import n from"cross-fetch";import{fromParse5 as r}from"hast-util-from-parse5";import*as a from"@citation-js/core/lib/index.js";import{parsers as i}from"@citation-js/core/lib/plugin-common/input/index.js";import o from"@citation-js/core/lib/plugin-common/output/index.js";import{parsers as l}from"@citation-js/plugin-bibjson/lib/index.js";import"@citation-js/plugin-bibtex/lib/index.js";import"@citation-js/plugin-csl/lib/index.js";import{fetchEngine as s}from"@citation-js/plugin-csl/lib/engines.js";import{formats as c}from"@citation-js/plugin-bibtex/lib/input/index.js";import*as m from"@citation-js/plugin-bibtex/lib/input/entries.js";import*as u from"@citation-js/plugin-bibtex/lib/input/bibtxt.js";import p from"@citation-js/plugin-bibtex/lib/output/index.js";import*as f from"@citation-js/plugin-bibtex/lib/output/entries.js";import{Converters as h}from"@citation-js/plugin-bibtex/lib/mapping/shared.js";import{format as d}from"@citation-js/plugin-bibtex/lib/output/bibtxt.js";import b from"citeproc";import*as x from"@citation-js/name";import*as g from"@citation-js/date";function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var w=/\[([^[\]]*@[^[\]]+)\]|(?!\b)(@[a-zA-Z0-9_][a-zA-Z0-9_:.#$%&\-+?<>~]*)/,j=/@([a-zA-Z0-9_][a-zA-Z0-9_:.#$%&\-+?<>~]*)/,k=/\[.*\]/,z={book:"book","bk.":"book","bks.":"book",chapter:"chapter","chap.":"chapter","chaps.":"chapter",column:"column","col.":"column","cols.":"column",figure:"figure","fig.":"figure","figs.":"figure",folio:"folio","fol.":"folio","fols.":"folio",number:"number","no.":"number","nos.":"number",line:"line","l.":"line","ll.":"line",note:"note","n.":"note","nn.":"note",opus:"opus","op.":"opus","opp.":"opus",page:"page","p.":"page","pp.":"page",paragraph:"paragraph","para.":"paragraph","paras.":"paragraph",part:"part","pt.":"part","pts.":"part",section:"section","sec.":"section","secs.":"section","sub verbo":"sub verbo","s.v.":"sub verbo","s.vv.":"sub verbo",verse:"verse","v.":"verse","vv.":"verse",volume:"volume","vol.":"volume","vols.":"volume","¶":"paragraph","¶¶":"paragraph","§":"section","§§":"section"},A="undefined"==typeof window,_=function(e){var t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol},O=["div","p","span","li"],L={article:"article","article-journal":"article","article-magazine":"article","article-newspaper":"article",book:"book",chapter:"inbook",manuscript:"unpublished","paper-conference":"inproceedings",report:"techreport",review:"article","review-book":"article"},C={getAttributedEntry:function(e,t,n){return e.replace(/^\s*<[a-z]+/i,"$& data-"+t+'="'+n+'"')},getPrefixedEntry:function(e,t){return C.getAttributedEntry(e,"csl-entry-id",t)},getWrappedEntry:function(e,t,n){var r=function(e,t){return"function"==typeof t?t(e):null==t?t:""};if(null==n.prepend&&null==n.append)return e;var a=r(t,n.prepend),i=r(t,n.append),o="",l="",s=e.match(/^([^>]+>)([\s\S]+)(<[^<]+)$/i);return s&&(o=s[1],e=s[2],l=s[3]),o+a+e+i+l}};function I(e,t){if(!(this instanceof I))return new I(e,t);var n=new a.Cite(e,t);this._options=n._options,this.log=n.log,this.data=n.data}I.prototype=Object.create(a.Cite.prototype),I.async=a.Cite.async,I.validateOptions=a.Cite.validateOptions,I.validateOutputOptions=a.Cite.validateOutputOptions,I.input=a.plugins.input.chain,I.inputAsync=a.plugins.input.chainAsync,I.util=Object.assign({attr:C},a.util),I.version={cite:a.version,citeproc:b.PROCESSOR_VERSION};var S=a.plugins.config.get("@csl");I.CSL={engine:s,item:function(e){return function(t){return e.find(function(e){return e.id===t})}},locale:function(e){return S.styles.get(S.styles.has(e)?e:"en-US")},style:function(e){return S.templates.get(S.templates.has(e)?e:"apa")},register:{addTemplate:S.templates.add.bind(S.templates),getTemplate:S.templates.get.bind(S.templates),hasTemplate:S.templates.has.bind(S.templates),addLocale:S.locales.add.bind(S.locales),getLocale:S.locales.get.bind(S.locales),hasLocale:S.locales.has.bind(S.locales)}},delete(I.plugins=function e(t){var n={};for(var r in t)n[r]="object"==typeof t[r]?e(t[r]):t[r];return n}(a.plugins)).input.util.clean,I.parse=Object.assign({input:{chain:a.plugins.input.chain,chainAsync:a.plugins.input.chainAsync,chainLink:a.plugins.input.chainLink,chainLinkAsync:a.plugins.input.chainLinkAsync,data:a.plugins.input.data,dataAsync:a.plugins.input.dataAsync,type:a.plugins.input.type,async:{chain:a.plugins.input.chainAsync,chainLink:a.plugins.input.chainLinkAsync,data:a.plugins.input.dataAsync}},name:x.parse,date:g.parse,csl:a.plugins.input.util.clean,bibjson:l.json.record,bibtex:function(e,t,n){return{json:function(e){return e.parse([].concat(e))},prop:function(e,n){var r,a=t.parse([{type:"book",properties:(r={},r[e]=n,r)}])[0],i=Object.keys(a).find(function(e){return"type"!==e[0]});return[i,a[i]]},text:function(t){return e["@biblatex/text"].parse(t)},type:function(e){return n[e]||"book"}}}(c,m,L),bibtxt:function(e){return{text:e.parse,textEntry:e.textEntry}}(u),json:i.json.parse},I.plugins.input),I.get=Object.assign({dict:I.plugins.dict,name:x.format,date:g.format,bibtex:function(e,t,n,r){return{json:function(e){return t.formatBibtex([e])[0]},label:function(e){return n.LABEL.toSource(e.id,e["citation-label"],e.author,e.issued,e["year-suffix"],e.title)},text:function(t,n){return e.bibtex(t,{format:n?"html":"text"})},type:function(e){return r[e]||"misc"}}}(p,f,h,L),bibtxt:d,json:o.data,label:o.label},I.plugins.output);var R=I.plugins.config.get("@csl");R.templates.add("mla",'<?xml version="1.0" encoding="utf-8"?>\n<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="never" page-range-format="minimal-two">\n  <info>\n    <title>Modern Language Association 9th edition</title>\n    <title-short>MLA</title-short>\n    <id>http://www.zotero.org/styles/modern-language-association</id>\n    <link href="http://www.zotero.org/styles/modern-language-association" rel="self"/>\n    <link href="http://style.mla.org" rel="documentation"/>\n    <author>\n      <name>Sebastian Karcher</name>\n    </author>\n    <category citation-format="author"/>\n    <category field="generic-base"/>\n    <summary>This style adheres to the MLA 9th edition handbook. Follows the structure of references as outlined in the MLA Manual closely</summary>\n    <updated>2021-07-13T20:05:10+00:00</updated>\n    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>\n  </info>\n  <locale xml:lang="en">\n    <date form="text">\n      <date-part name="day" suffix=" "/>\n      <date-part name="month" suffix=" " form="short"/>\n      <date-part name="year"/>\n    </date>\n    <terms>\n      <term name="month-01" form="short">Jan.</term>\n      <term name="month-02" form="short">Feb.</term>\n      <term name="month-03" form="short">Mar.</term>\n      <term name="month-04" form="short">Apr.</term>\n      <term name="month-05" form="short">May</term>\n      <term name="month-06" form="short">June</term>\n      <term name="month-07" form="short">July</term>\n      <term name="month-08" form="short">Aug.</term>\n      <term name="month-09" form="short">Sept.</term>\n      <term name="month-10" form="short">Oct.</term>\n      <term name="month-11" form="short">Nov.</term>\n      <term name="month-12" form="short">Dec.</term>\n      <term name="translator" form="short">trans.</term>\n    </terms>\n  </locale>\n  <macro name="author">\n    <names variable="author">\n      <name name-as-sort-order="first" and="text" delimiter-precedes-last="always" delimiter-precedes-et-al="always" initialize="false" initialize-with=". "/>\n      <label form="long" prefix=", "/>\n      <substitute>\n        <names variable="editor"/>\n        <names variable="translator"/>\n        <text macro="title"/>\n      </substitute>\n    </names>\n  </macro>\n  <macro name="author-short">\n    <group delimiter=", ">\n      <names variable="author">\n        <name form="short" initialize-with=". " and="text"/>\n        <substitute>\n          <names variable="editor"/>\n          <names variable="translator"/>\n          <text macro="title-short"/>\n        </substitute>\n      </names>\n      <choose>\n        <if disambiguate="true">\n          <text macro="title-short"/>\n        </if>\n      </choose>\n    </group>\n  </macro>\n  <macro name="title">\n    <choose>\n      <if variable="container-title" match="any">\n        <text variable="title" quotes="true" text-case="title"/>\n      </if>\n      <else>\n        <text variable="title" font-style="italic" text-case="title"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="title-short">\n    <choose>\n      <if variable="container-title" match="any">\n        <text variable="title" form="short" quotes="true" text-case="title"/>\n      </if>\n      <else>\n        <text variable="title" form="short" font-style="italic" text-case="title"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="container-title">\n    <text variable="container-title" font-style="italic" text-case="title"/>\n  </macro>\n  <macro name="other-contributors">\n    <choose>\n      <if variable="container-title" match="any">\n        <group delimiter=", ">\n          <names variable="container-author" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text"/>\n          </names>\n          <names variable="editor translator" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text"/>\n          </names>\n          <names variable="director illustrator interviewer" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text"/>\n          </names>\n        </group>\n      </if>\n      <else>\n        <group delimiter=", ">\n          <names variable="container-author" delimiter=", ">\n            <label form="verb" suffix=" " text-case="capitalize-first"/>\n            <name and="text"/>\n          </names>\n          <names variable="editor translator" delimiter=", ">\n            <label form="verb" suffix=" " text-case="capitalize-first"/>\n            <name and="text"/>\n          </names>\n          <names variable="director illustrator interviewer" delimiter=", ">\n            <label form="verb" suffix=" " text-case="capitalize-first"/>\n            <name and="text"/>\n          </names>\n        </group>\n      </else>\n    </choose>\n  </macro>\n  <macro name="version">\n    <group delimiter=", ">\n      <choose>\n        <if is-numeric="edition">\n          <group delimiter=" ">\n            <number variable="edition" form="ordinal"/>\n            <text term="edition" form="short"/>\n          </group>\n        </if>\n        <else>\n          <text variable="edition" text-case="capitalize-first"/>\n        </else>\n      </choose>\n      <text variable="version"/>\n    </group>\n  </macro>\n  <macro name="volume-lowercase">\n    <group delimiter=" ">\n      <text term="volume" form="short"/>\n      <text variable="volume"/>\n    </group>\n  </macro>\n  <macro name="number">\n    <group delimiter=", ">\n      <group>\n        <choose>\n          \x3c!--lowercase if we have a preceding element--\x3e\n          <if variable="edition container-title" match="any">\n            <text macro="volume-lowercase"/>\n          </if>\n          \x3c!--other contributors preceding the volume--\x3e\n          <else-if variable="author" match="all">\n            <choose>\n              <if variable="editor translator container-author illustrator interviewer director" match="any">\n                <text macro="volume-lowercase"/>\n              </if>\n            </choose>\n          </else-if>\n          <else-if variable="editor" match="all">\n            <choose>\n              <if variable="translator container-author illustrator interviewer director" match="any">\n                <text macro="volume-lowercase"/>\n              </if>\n            </choose>\n          </else-if>\n          <else-if variable="container-author illustrator interviewer director" match="any">\n            <text macro="volume-lowercase"/>\n          </else-if>\n          <else>\n            <group delimiter=" ">\n              <text term="volume" form="short" text-case="capitalize-first"/>\n              <text variable="volume"/>\n            </group>\n          </else>\n        </choose>\n      </group>\n      <group delimiter=" ">\n        <text term="issue" form="short"/>\n        <text variable="issue"/>\n      </group>\n      <choose>\n        <if type="report">\n          <text variable="genre"/>\n        </if>\n      </choose>\n      <text variable="number"/>\n    </group>\n  </macro>\n  <macro name="publisher">\n    <text variable="publisher"/>\n  </macro>\n  <macro name="publication-date">\n    <choose>\n      <if type="book chapter paper-conference motion_picture" match="any">\n        <date variable="issued" form="numeric" date-parts="year"/>\n      </if>\n      <else-if type="article-journal article-magazine" match="any">\n        <date variable="issued" form="text" date-parts="year-month"/>\n      </else-if>\n      <else-if type="speech" match="none">\n        <date variable="issued" form="text"/>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="location">\n    <group delimiter=", ">\n      <group delimiter=" ">\n        <label variable="page" form="short"/>\n        <text variable="page"/>\n      </group>\n      <choose>\n        <if variable="source" match="none">\n          <text macro="URI"/>\n        </if>\n      </choose>\n    </group>\n  </macro>\n  <macro name="container2-title">\n    <group delimiter=", ">\n      <choose>\n        <if type="speech">\n          <text variable="event"/>\n          <date variable="event-date" form="text"/>\n          <text variable="event-place"/>\n        </if>\n      </choose>\n      <text variable="archive"/>\n      <text variable="archive-place"/>\n      <text variable="archive_location"/>\n    </group>\n  </macro>\n  <macro name="container2-location">\n    <choose>\n      <if variable="source">\n        <choose>\n          <if variable="DOI URL" match="any">\n            <group delimiter=", ">\n              <text variable="source" font-style="italic"/>\n              <text macro="URI"/>\n            </group>\n          </if>\n        </choose>\n      </if>\n    </choose>\n  </macro>\n  <macro name="URI">\n    <choose>\n      <if variable="DOI">\n        <text variable="DOI" prefix="https://doi.org/"/>\n      </if>\n      <else>\n        <text variable="URL"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="accessed">\n    \x3c!--using accessed where we don\'t have an issued date; follows recommendation on p. 53 --\x3e\n    <choose>\n      <if variable="issued" match="none">\n        <group delimiter=" ">\n          <text term="accessed" text-case="capitalize-first"/>\n          <date variable="accessed" form="text"/>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <citation et-al-min="3" et-al-use-first="1" disambiguate-add-names="true" disambiguate-add-givenname="true">\n    <layout prefix="(" suffix=")" delimiter="; ">\n      <choose>\n        <if locator="page line" match="any">\n          <group delimiter=" ">\n            <text macro="author-short"/>\n            <text variable="locator"/>\n          </group>\n        </if>\n        <else>\n          <group delimiter=", ">\n            <text macro="author-short"/>\n            <group>\n              <label variable="locator" form="short"/>\n              <text variable="locator"/>\n            </group>\n          </group>\n        </else>\n      </choose>\n    </layout>\n  </citation>\n  <bibliography hanging-indent="true" et-al-min="3" et-al-use-first="1" line-spacing="2" entry-spacing="0" subsequent-author-substitute="---">\n    <sort>\n      <key macro="author"/>\n      <key variable="title"/>\n    </sort>\n    <layout suffix=".">\n      <group delimiter=". ">\n        <text macro="author"/>\n        <text macro="title"/>\n        <date variable="original-date" form="numeric" date-parts="year"/>\n        <group delimiter=", ">\n          \x3c!---This group corresponds to MLA\'s "Container 1"--\x3e\n          <text macro="container-title"/>\n          <text macro="other-contributors"/>\n          <text macro="version"/>\n          <text macro="number"/>\n          <text macro="publisher"/>\n          <text macro="publication-date"/>\n          <text macro="location"/>\n        </group>\n        <group delimiter=", ">\n          \x3c!---This group corresponds to MLA\'s "Container 2"--\x3e\n          \x3c!--currently just using this one for archival info--\x3e\n          <text macro="container2-title"/>\n          <text macro="container2-location"/>\n        </group>\n        <text macro="accessed"/>\n      </group>\n    </layout>\n  </bibliography>\n</style>'),R.templates.add("chicago",'<?xml version="1.0" encoding="utf-8"?>\n<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="display-and-sort" page-range-format="chicago">\n  <info>\n    <title>Chicago Manual of Style 17th edition (author-date)</title>\n    <id>http://www.zotero.org/styles/chicago-author-date</id>\n    <link href="http://www.zotero.org/styles/chicago-author-date" rel="self"/>\n    <link href="http://www.chicagomanualofstyle.org/tools_citationguide.html" rel="documentation"/>\n    <author>\n      <name>Julian Onions</name>\n      <email>julian.onions@gmail.com</email>\n    </author>\n    <contributor>\n      <name>Sebastian Karcher</name>\n    </contributor>\n    <contributor>\n      <name>Richard Karnesky</name>\n      <email>karnesky+zotero@gmail.com</email>\n      <uri>http://arc.nucapt.northwestern.edu/Richard_Karnesky</uri>\n    </contributor>\n    <contributor>\n      <name>Andrew Dunning</name>\n      <email>andrew.dunning@utoronto.ca</email>\n      <uri>https://orcid.org/0000-0003-0464-5036</uri>\n    </contributor>\n    <contributor>\n      <name>Matthew Roth</name>\n      <email>matthew.g.roth@yale.edu</email>\n      <uri> https://orcid.org/0000-0001-7902-6331</uri>\n    </contributor>\n    <contributor>\n      <name>Brenton M. Wiernik</name>\n    </contributor>\n    <category citation-format="author-date"/>\n    <category field="generic-base"/>\n    <summary>The author-date variant of the Chicago style</summary>\n    <updated>2018-01-24T12:00:00+00:00</updated>\n    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>\n  </info>\n  <locale xml:lang="en">\n    <terms>\n      <term name="editor" form="verb-short">ed.</term>\n      <term name="container-author" form="verb">by</term>\n      <term name="translator" form="verb-short">trans.</term>\n      <term name="editortranslator" form="verb">edited and translated by</term>\n      <term name="translator" form="short">trans.</term>\n    </terms>\n  </locale>\n  <macro name="secondary-contributors">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="none">\n        <group delimiter=". ">\n          <names variable="editor translator" delimiter=". ">\n            <label form="verb" text-case="capitalize-first" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n          <names variable="director" delimiter=". ">\n            <label form="verb" text-case="capitalize-first" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <macro name="container-contributors">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <group prefix=", " delimiter=", ">\n          <names variable="container-author" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n          <names variable="editor translator" delimiter=", ">\n            <label form="verb" suffix=" "/>\n            <name and="text" delimiter=", "/>\n          </names>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <macro name="editor">\n    <names variable="editor">\n      <name name-as-sort-order="first" and="text" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>\n      <label form="short" prefix=", "/>\n    </names>\n  </macro>\n  <macro name="translator">\n    <names variable="translator">\n      <name name-as-sort-order="first" and="text" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>\n      <label form="short" prefix=", "/>\n    </names>\n  </macro>\n  <macro name="recipient">\n    <choose>\n      <if type="personal_communication">\n        <choose>\n          <if variable="genre">\n            <text variable="genre" text-case="capitalize-first"/>\n          </if>\n          <else>\n            <text term="letter" text-case="capitalize-first"/>\n          </else>\n        </choose>\n      </if>\n    </choose>\n    <names variable="recipient" delimiter=", ">\n      <label form="verb" prefix=" " text-case="lowercase" suffix=" "/>\n      <name and="text" delimiter=", "/>\n    </names>\n  </macro>\n  <macro name="substitute-title">\n    <choose>\n      <if type="article-magazine article-newspaper review review-book" match="any">\n        <text macro="container-title"/>\n      </if>\n    </choose>\n  </macro>\n  <macro name="contributors">\n    <group delimiter=". ">\n      <names variable="author">\n        <name and="text" name-as-sort-order="first" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>\n        <label form="short" prefix=", "/>\n        <substitute>\n          <names variable="editor"/>\n          <names variable="translator"/>\n          <names variable="director"/>\n          <text macro="substitute-title"/>\n          <text macro="title"/>\n        </substitute>\n      </names>\n      <text macro="recipient"/>\n    </group>\n  </macro>\n  <macro name="contributors-short">\n    <names variable="author">\n      <name form="short" and="text" delimiter=", " initialize-with=". "/>\n      <substitute>\n        <names variable="editor"/>\n        <names variable="translator"/>\n        <names variable="director"/>\n        <text macro="substitute-title"/>\n        <text macro="title"/>\n      </substitute>\n    </names>\n  </macro>\n  <macro name="interviewer">\n    <names variable="interviewer" delimiter=", ">\n      <label form="verb" prefix=" " text-case="capitalize-first" suffix=" "/>\n      <name and="text" delimiter=", "/>\n    </names>\n  </macro>\n  <macro name="archive">\n    <group delimiter=". ">\n      <text variable="archive_location" text-case="capitalize-first"/>\n      <text variable="archive"/>\n      <text variable="archive-place"/>\n    </group>\n  </macro>\n  <macro name="access">\n    <group delimiter=". ">\n      <choose>\n        <if type="graphic report" match="any">\n          <text macro="archive"/>\n        </if>\n        <else-if type="article-journal bill book chapter legal_case legislation motion_picture paper-conference" match="none">\n          <text macro="archive"/>\n        </else-if>\n      </choose>\n      <choose>\n        <if type="webpage post-weblog" match="any">\n          <date variable="issued" form="text"/>\n        </if>\n      </choose>\n      <choose>\n        <if variable="issued" match="none">\n          <group delimiter=" ">\n            <text term="accessed" text-case="capitalize-first"/>\n            <date variable="accessed" form="text"/>\n          </group>\n        </if>\n      </choose>\n      <choose>\n        <if type="legal_case" match="none">\n          <choose>\n            <if variable="DOI">\n              <text variable="DOI" prefix="https://doi.org/"/>\n            </if>\n            <else>\n              <text variable="URL"/>\n            </else>\n          </choose>\n        </if>\n      </choose>\n    </group>\n  </macro>\n  <macro name="title">\n    <choose>\n      <if variable="title" match="none">\n        <choose>\n          <if type="personal_communication" match="none">\n            <text variable="genre" text-case="capitalize-first"/>\n          </if>\n        </choose>\n      </if>\n      <else-if type="bill book graphic legislation motion_picture song" match="any">\n        <text variable="title" text-case="title" font-style="italic"/>\n        <group prefix=" (" suffix=")" delimiter=" ">\n          <text term="version"/>\n          <text variable="version"/>\n        </group>\n      </else-if>\n      <else-if variable="reviewed-author">\n        <choose>\n          <if variable="reviewed-title">\n            <group delimiter=". ">\n              <text variable="title" text-case="title" quotes="true"/>\n              <group delimiter=", ">\n                <text variable="reviewed-title" text-case="title" font-style="italic" prefix="Review of "/>\n                <names variable="reviewed-author">\n                  <label form="verb-short" text-case="lowercase" suffix=" "/>\n                  <name and="text" delimiter=", "/>\n                </names>\n              </group>\n            </group>\n          </if>\n          <else>\n            <group delimiter=", ">\n              <text variable="title" text-case="title" font-style="italic" prefix="Review of "/>\n              <names variable="reviewed-author">\n                <label form="verb-short" text-case="lowercase" suffix=" "/>\n                <name and="text" delimiter=", "/>\n              </names>\n            </group>\n          </else>\n        </choose>\n      </else-if>\n      <else-if type="legal_case interview patent" match="any">\n        <text variable="title"/>\n      </else-if>\n      <else>\n        <text variable="title" text-case="title" quotes="true"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="edition">\n    <choose>\n      <if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n        <choose>\n          <if is-numeric="edition">\n            <group delimiter=" " prefix=". ">\n              <number variable="edition" form="ordinal"/>\n              <text term="edition" form="short" strip-periods="true"/>\n            </group>\n          </if>\n          <else>\n            <text variable="edition" text-case="capitalize-first" prefix=". "/>\n          </else>\n        </choose>\n      </if>\n      <else-if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <choose>\n          <if is-numeric="edition">\n            <group delimiter=" " prefix=", ">\n              <number variable="edition" form="ordinal"/>\n              <text term="edition" form="short"/>\n            </group>\n          </if>\n          <else>\n            <text variable="edition" prefix=", "/>\n          </else>\n        </choose>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="locators">\n    <choose>\n      <if type="article-journal">\n        <choose>\n          <if variable="volume">\n            <text variable="volume" prefix=" "/>\n            <group prefix=" (" suffix=")">\n              <choose>\n                <if variable="issue">\n                  <text variable="issue"/>\n                </if>\n                <else>\n                  <date variable="issued">\n                    <date-part name="month"/>\n                  </date>\n                </else>\n              </choose>\n            </group>\n          </if>\n          <else-if variable="issue">\n            <group delimiter=" " prefix=", ">\n              <text term="issue" form="short"/>\n              <text variable="issue"/>\n              <date variable="issued" prefix="(" suffix=")">\n                <date-part name="month"/>\n              </date>\n            </group>\n          </else-if>\n          <else>\n            <date variable="issued" prefix=", ">\n              <date-part name="month"/>\n            </date>\n          </else>\n        </choose>\n      </if>\n      <else-if type="legal_case">\n        <text variable="volume" prefix=", "/>\n        <text variable="container-title" prefix=" "/>\n        <text variable="page" prefix=" "/>\n      </else-if>\n      <else-if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n        <group prefix=". " delimiter=". ">\n          <group>\n            <text term="volume" form="short" text-case="capitalize-first" suffix=" "/>\n            <number variable="volume" form="numeric"/>\n          </group>\n          <group>\n            <number variable="number-of-volumes" form="numeric"/>\n            <text term="volume" form="short" prefix=" " plural="true"/>\n          </group>\n        </group>\n      </else-if>\n      <else-if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <choose>\n          <if variable="page" match="none">\n            <group prefix=". ">\n              <text term="volume" form="short" text-case="capitalize-first" suffix=" "/>\n              <number variable="volume" form="numeric"/>\n            </group>\n          </if>\n        </choose>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="locators-chapter">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <choose>\n          <if variable="page">\n            <group prefix=", ">\n              <text variable="volume" suffix=":"/>\n              <text variable="page"/>\n            </group>\n          </if>\n        </choose>\n      </if>\n    </choose>\n  </macro>\n  <macro name="locators-article">\n    <choose>\n      <if type="article-newspaper">\n        <group prefix=", " delimiter=", ">\n          <group delimiter=" ">\n            <text variable="edition"/>\n            <text term="edition"/>\n          </group>\n          <group>\n            <text term="section" form="short" suffix=" "/>\n            <text variable="section"/>\n          </group>\n        </group>\n      </if>\n      <else-if type="article-journal">\n        <choose>\n          <if variable="volume issue" match="any">\n            <text variable="page" prefix=": "/>\n          </if>\n          <else>\n            <text variable="page" prefix=", "/>\n          </else>\n        </choose>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="point-locators">\n    <choose>\n      <if variable="locator">\n        <choose>\n          <if locator="page" match="none">\n            <choose>\n              <if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n                <choose>\n                  <if variable="volume">\n                    <group>\n                      <text term="volume" form="short" suffix=" "/>\n                      <number variable="volume" form="numeric"/>\n                      <label variable="locator" form="short" prefix=", " suffix=" "/>\n                    </group>\n                  </if>\n                  <else>\n                    <label variable="locator" form="short" suffix=" "/>\n                  </else>\n                </choose>\n              </if>\n              <else>\n                <label variable="locator" form="short" suffix=" "/>\n              </else>\n            </choose>\n          </if>\n          <else-if type="bill book graphic legal_case legislation motion_picture report song" match="any">\n            <number variable="volume" form="numeric" suffix=":"/>\n          </else-if>\n        </choose>\n        <text variable="locator"/>\n      </if>\n    </choose>\n  </macro>\n  <macro name="container-prefix">\n    <text term="in" text-case="capitalize-first"/>\n  </macro>\n  <macro name="container-title">\n    <choose>\n      <if type="chapter entry-dictionary entry-encyclopedia paper-conference" match="any">\n        <text macro="container-prefix" suffix=" "/>\n      </if>\n    </choose>\n    <choose>\n      <if type="webpage">\n        <text variable="container-title" text-case="title"/>\n      </if>\n      <else-if type="legal_case" match="none">\n        <group delimiter=" ">\n          <text variable="container-title" text-case="title" font-style="italic"/>\n          <choose>\n            <if type="post-weblog">\n              <text value="(blog)"/>\n            </if>\n          </choose>\n        </group>\n      </else-if>\n    </choose>\n  </macro>\n  <macro name="publisher">\n    <group delimiter=": ">\n      <text variable="publisher-place"/>\n      <text variable="publisher"/>\n    </group>\n  </macro>\n  <macro name="date">\n    <choose>\n      <if variable="issued">\n        <group delimiter=" ">\n          <date variable="original-date" form="text" date-parts="year" prefix="(" suffix=")"/>\n          <date variable="issued">\n            <date-part name="year"/>\n          </date>\n        </group>\n      </if>\n      <else-if variable="status">\n        <text variable="status" text-case="capitalize-first"/>\n      </else-if>\n      <else>\n        <text term="no date" form="short"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="date-in-text">\n    <choose>\n      <if variable="issued">\n        <group delimiter=" ">\n          <date variable="original-date" form="text" date-parts="year" prefix="[" suffix="]"/>\n          <date variable="issued">\n            <date-part name="year"/>\n          </date>\n        </group>\n      </if>\n      <else-if variable="status">\n        <text variable="status"/>\n      </else-if>\n      <else>\n        <text term="no date" form="short"/>\n      </else>\n    </choose>\n  </macro>\n  <macro name="day-month">\n    <date variable="issued">\n      <date-part name="month"/>\n      <date-part name="day" prefix=" "/>\n    </date>\n  </macro>\n  <macro name="collection-title">\n    <choose>\n      <if match="none" type="article-journal">\n        <choose>\n          <if match="none" is-numeric="collection-number">\n            <group delimiter=", ">\n              <text variable="collection-title" text-case="title"/>\n              <text variable="collection-number"/>\n            </group>\n          </if>\n          <else>\n            <group delimiter=" ">\n              <text variable="collection-title" text-case="title"/>\n              <text variable="collection-number"/>\n            </group>\n          </else>\n        </choose>\n      </if>\n    </choose>\n  </macro>\n  <macro name="collection-title-journal">\n    <choose>\n      <if type="article-journal">\n        <group delimiter=" ">\n          <text variable="collection-title"/>\n          <text variable="collection-number"/>\n        </group>\n      </if>\n    </choose>\n  </macro>\n  <macro name="event">\n    <group delimiter=" ">\n      <choose>\n        <if variable="genre">\n          <text term="presented at"/>\n        </if>\n        <else>\n          <text term="presented at" text-case="capitalize-first"/>\n        </else>\n      </choose>\n      <text variable="event"/>\n    </group>\n  </macro>\n  <macro name="description">\n    <choose>\n      <if variable="interviewer" type="interview" match="any">\n        <group delimiter=". ">\n          <text macro="interviewer"/>\n          <text variable="medium" text-case="capitalize-first"/>\n        </group>\n      </if>\n      <else-if type="patent">\n        <group delimiter=" " prefix=". ">\n          <text variable="authority"/>\n          <text variable="number"/>\n        </group>\n      </else-if>\n      <else>\n        <text variable="medium" text-case="capitalize-first" prefix=". "/>\n      </else>\n    </choose>\n    <choose>\n      <if variable="title" match="none"/>\n      <else-if type="thesis personal_communication speech" match="any"/>\n      <else>\n        <group delimiter=" " prefix=". ">\n          <text variable="genre" text-case="capitalize-first"/>\n          <choose>\n            <if type="report">\n              <text variable="number"/>\n            </if>\n          </choose>\n        </group>\n      </else>\n    </choose>\n  </macro>\n  <macro name="issue">\n    <choose>\n      <if type="legal_case">\n        <text variable="authority" prefix=". "/>\n      </if>\n      <else-if type="speech">\n        <group prefix=". " delimiter=", ">\n          <group delimiter=" ">\n            <text variable="genre" text-case="capitalize-first"/>\n            <text macro="event"/>\n          </group>\n          <text variable="event-place"/>\n          <text macro="day-month"/>\n        </group>\n      </else-if>\n      <else-if type="article-newspaper article-magazine personal_communication" match="any">\n        <date variable="issued" form="text" prefix=", "/>\n      </else-if>\n      <else-if type="patent">\n        <group delimiter=", " prefix=", ">\n          <group delimiter=" ">\n            \x3c!--Needs Localization--\x3e\n            <text value="filed"/>\n            <date variable="submitted" form="text"/>\n          </group>\n          <group delimiter=" ">\n            <choose>\n              <if variable="issued submitted" match="all">\n                <text term="and"/>\n              </if>\n            </choose>\n            \x3c!--Needs Localization--\x3e\n            <text value="issued"/>\n            <date variable="issued" form="text"/>\n          </group>\n        </group>\n      </else-if>\n      <else-if type="article-journal" match="any"/>\n      <else>\n        <group prefix=". " delimiter=", ">\n          <choose>\n            <if type="thesis">\n              <text variable="genre" text-case="capitalize-first"/>\n            </if>\n          </choose>\n          <text macro="publisher"/>\n        </group>\n      </else>\n    </choose>\n  </macro>\n  <citation et-al-min="4" et-al-use-first="1" disambiguate-add-year-suffix="true" disambiguate-add-names="true" disambiguate-add-givenname="true" givenname-disambiguation-rule="primary-name" collapse="year" after-collapse-delimiter="; ">\n    <layout prefix="(" suffix=")" delimiter="; ">\n      <group delimiter=", ">\n        <choose>\n          <if variable="issued accessed" match="any">\n            <group delimiter=" ">\n              <text macro="contributors-short"/>\n              <text macro="date-in-text"/>\n            </group>\n          </if>\n          \x3c!---comma before forthcoming and n.d.--\x3e\n          <else>\n            <group delimiter=", ">\n              <text macro="contributors-short"/>\n              <text macro="date-in-text"/>\n            </group>\n          </else>\n        </choose>\n        <text macro="point-locators"/>\n      </group>\n    </layout>\n  </citation>\n  <bibliography hanging-indent="true" et-al-min="11" et-al-use-first="7" subsequent-author-substitute="&#8212;&#8212;&#8212;" entry-spacing="0">\n    <sort>\n      <key macro="contributors"/>\n      <key variable="issued"/>\n      <key variable="title"/>\n    </sort>\n    <layout suffix=".">\n      <group delimiter=". ">\n        <text macro="contributors"/>\n        <text macro="date"/>\n        <text macro="title"/>\n      </group>\n      <text macro="description"/>\n      <text macro="secondary-contributors" prefix=". "/>\n      <text macro="container-title" prefix=". "/>\n      <text macro="container-contributors"/>\n      <text macro="edition"/>\n      <text macro="locators-chapter"/>\n      <text macro="collection-title-journal" prefix=", " suffix=", "/>\n      <text macro="locators"/>\n      <text macro="collection-title" prefix=". "/>\n      <text macro="issue"/>\n      <text macro="locators-article"/>\n      <text macro="access" prefix=". "/>\n    </layout>\n  </bibliography>\n</style>');var T=function(a){return function(i){return void 0===i&&(i={}),function(o,l){try{return Promise.resolve(function(e,t){try{var n="",r=function(){if(!e.bibliography)return function(){var r,a;if(null!=t&&null!=(r=t.data)&&null!=(a=r.frontmatter)&&a.bibliography)return n=t.data.frontmatter.bibliography,function(){if(!_(n))return function(){if(A)return Promise.resolve(import("path").then(function(r){return r.join(e.path||t.cwd,n)})).then(function(e){n=e});throw new Error("Cannot read non valid bibliography URL in node env.")}()}()}();n=e.bibliography}();return Promise.resolve(r&&r.then?r.then(function(e){return n}):n)}catch(e){return Promise.reject(e)}}(i,l)).then(function(s){var c,m;function u(n){var l=new a(p),s=l.data.map(function(e){return e.id}),c=[],m=1,u=a.plugins.config.get("@csl").engine(l.data,f,i.lang||"en","html");if(e(o,"text",function(e,n,a){var i=e.value.match(w);if(i&&O.includes(a.tagName)){var o=i.index,l=i.index+i[0].length,p=[];0!==o&&p.push({type:"text",value:e.value.slice(0,o)});for(var f,h=function(e){var t,n=[];if(k.test(e)){t={noteIndex:0};for(var r,a=y(e.substr(1,e.length-2).split(";"));!(r=a()).done;){var i=r.value,o="",l="",s="page",c="",m=i.split("@");if(1===m.length)throw new Error("Cite key should be in the form of @key");if(m.length>2)throw new Error("More than one cite key @ detected, please separate keys with ;");o=(o+=m[0]).trim();var u=i.indexOf("@")>0&&"-"===i[i.indexOf("@")-1];u&&(o=o.substr(0,o.length-1).trim());var p=m[1].indexOf(",")+1;0===p&&(p=m[1].indexOf(" ")+1),p<=0&&(p=void 0);var f=i.substr(i.indexOf("@"),p).match(j)[0],h=i.split("@")[1].substr(f.length).trim();","===h[0]&&(h=h.substr(1).trim());var d=h.match(/(\d|-| |,)+/g);null!==d?(l=d[0].trim(),s=h.split(l)[0].trim(),s=z[s]||"page",c=h.split(l)[1].trim()):c=h.trim(),n.push({id:i.match(j)[1],locator:l,label:s,prefix:o,suffix:c,"suppress-author":u})}}else t={noteIndex:0,mode:"composite"},n=[e].map(function(e){return{id:e.match(j)[1]}});return[t,n]}(i[0]),d=h[0],b=h[1],x=y(b);!(f=x()).done;)if(!s.includes(f.value.id))return;var g=function(e,n,a,i,o){void 0===o&&(o={noteIndex:0});var l=e.processCitationCluster({citationID:a,citationItems:n,properties:o},i.length>0?i:[],[])[1].filter(function(e){return e[2]===a}),s=t.parseFragment("<div>"+l[0][1]+"</div>");return r(s).children[0].children[0]}(u,b,"CITATION-"+m,c,d);c.push(["CITATION-"+m,0]),m+=1,p.push(g),l<e.value.length&&p.push({type:"text",value:e.value.slice(l)}),a.children=[].concat(a.children.slice(0,n),p,a.children.slice(n+1))}}),i.noCite&&u.updateItems(i.noCite.map(function(e){return e.replace("@","")})),!i.suppressBibliography&&u.registry.mylist.length>=1){var h=function(e){var n='<div id="refs" class="references csl-bib-body">\n'+e.makeBibliography()[1].join("")+"</div>",a=t.parseFragment(n);return r(a).children[0]}(u),d=!1;e(o,"element",function(e,t,n){"p"!==e.tagName&&"div"!==e.tagName||"[^ref]"!==e.children[0].value||(n.children[t]=h,d=!0)}),d||o.children.push(h)}}if(s){var p,f=i.csl||(null==l||null==(c=l.data)||null==(m=c.frontmatter)?void 0:m.csl)||"apa",h=_(s)?Promise.resolve(n(s)).then(function(e){return Promise.resolve(e.text()).then(function(e){p=e})}):function(){if(A)return Promise.resolve(function(e){try{if(_(e))return Promise.resolve(n(e).then(function(e){return e.text()}).then(function(e){return e}));if(A)return Promise.resolve(import("fs").then(function(t){return t.readFileSync(e,"utf8")}));throw new Error("Cannot read non valid URL in node env.")}catch(e){return Promise.reject(e)}}(s)).then(function(e){p=e});throw new Error("Cannot read non valid bibliography URL in node env.")}();return h&&h.then?h.then(u):u()}})}catch(e){return Promise.reject(e)}}}}(I);export{T as default};
//# sourceMappingURL=rehype-citation.mjs.map
